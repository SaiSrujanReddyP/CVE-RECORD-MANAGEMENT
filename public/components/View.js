import React, { useState } from 'react';
import {
  Paper, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, TextField, TablePagination,
  FormControl, InputLabel, Select, MenuItem, Button
} from '@mui/material';

function View({ cveRecords, onEdit, onDelete, onAdd }) {
  const [filter, setFilter] = useState({
    cveId: '',
    severity: '',
    cvss: '',
    affectedPackages: '',
    cweId: '',
  });
  const [page, setPage] = useState(0);
  const [rowsPerPage, setRowsPerPage] = useState(5);

  const handleFilterChange = (e) => {
    const { name, value } = e.target;
    setFilter({ ...filter, [name]: value });
  };

  const handleChangePage = (event, newPage) => {
    setPage(newPage);
  };

  const handleChangeRowsPerPage = (event) => {
    setRowsPerPage(parseInt(event.target.value, 10));
    setPage(0);
  };

  const filteredRecords = cveRecords.filter((record) =>
    Object.keys(filter).every((key) =>
      record[key].toLowerCase().includes(filter[key].toLowerCase())
    )
  );

  return (
    <div style={{ padding: '20px' }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
        <h1>View CVE Records</h1>
        <Button
          variant="contained"
          color="primary"
          onClick={onAdd}
        >
          Add CVE
        </Button>
      </div>
      <div style={{ marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap' }}>
        <TextField
          name="cveId"
          label="Filter by CVE-ID"
          variant="outlined"
          value={filter.cveId}
          onChange={handleFilterChange}
        />
        <FormControl variant="outlined" style={{ minWidth: '120px' }}>
          <InputLabel>Severity</InputLabel>
          <Select
            name="severity"
            value={filter.severity}
            onChange={handleFilterChange}
            label="Severity"
          >
            <MenuItem value="">None</MenuItem>
            <MenuItem value="low">Low</MenuItem>
            <MenuItem value="medium">Medium</MenuItem>
            <MenuItem value="high">High</MenuItem>
            <MenuItem value="critical">Critical</MenuItem>
          </Select>
        </FormControl>
        <TextField
          name="cvss"
          label="Filter by CVSS"
          variant="outlined"
          value={filter.cvss}
          onChange={handleFilterChange}
        />
        <TextField
          name="affectedPackages"
          label="Filter by Affected Packages"
          variant="outlined"
          value={filter.affectedPackages}
          onChange={handleFilterChange}
        />
        <TextField
          name="cweId"
          label="Filter by CWE-ID"
          variant="outlined"
          value={filter.cweId}
          onChange={handleFilterChange}
        />
      </div>
      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell style={{ fontWeight: 'bold' }}>CVE-ID</TableCell>
              <TableCell style={{ fontWeight: 'bold' }}>Severity</TableCell>
              <TableCell style={{ fontWeight: 'bold' }}>CVSS</TableCell>
              <TableCell style={{ fontWeight: 'bold' }}>Affected Packages</TableCell>
              <TableCell style={{ fontWeight: 'bold' }}>CWE-ID</TableCell>
              <TableCell style={{ fontWeight: 'bold' }}>Actions</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {filteredRecords.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage).map((record, index) => (
              <TableRow key={index}>
                <TableCell>{record.cveId}</TableCell>
                <TableCell>{record.severity}</TableCell>
                <TableCell>{record.cvss}</TableCell>
                <TableCell>{record.affectedPackages}</TableCell>
                <TableCell>{record.cweId}</TableCell>
                <TableCell>
                  <Button onClick={() => onEdit(index)} color="primary" variant="outlined" style={{ marginRight: '8px' }}>
                    Edit
                  </Button>
                  <Button onClick={() => onDelete(index)} color="secondary" variant="outlined">
                    Delete
                  </Button>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
        <TablePagination
          component="div"
          count={filteredRecords.length}
          page={page}
          onPageChange={handleChangePage}
          rowsPerPage={rowsPerPage}
          onRowsPerPageChange={handleChangeRowsPerPage}
        />
      </TableContainer>
    </div>
  );
}

export default View;